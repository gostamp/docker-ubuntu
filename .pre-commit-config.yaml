---
default_install_hook_types: [commit-msg, pre-commit]
default_stages: [commit, manual]
fail_fast: true

repos:
  - repo: local
    hooks:
      # https://github.com/mvdan/sh
      - id: shfmt
        name: "Format: shfmt"
        entry: ./bin/run-in-container.sh shfmt
        args:
          - --write
        language: system
        types_or:
          - dockerfile
          - shell

      # https://github.com/google/yamlfmt
      - id: yamlfmt
        name: "Format: yamlfmt"
        entry: ./bin/run-in-container.sh yamlfmt
        args:
          - --conf=.yamlfmt.yaml
        language: system
        types:
          - yaml

      # https://github.com/streetsidesoftware/cspell
      - id: cspell
        name: "Lint: cspell"
        entry: ./bin/run-in-container.sh cspell
        args:
          - --gitignore
          - --no-must-find-files
          - --no-progress
          - --no-summary
          - --show-suggestions
        language: system
        require_serial: true
        types:
          - text

      - id: dotenv-linter
        name: "Lint: dotenv-linter"
        entry: ./bin/run-in-container.sh dotenv-linter
        args:
          - --not-check-updates
          # .env is in the .gitignore file, so pre-commit won't
          # ever try to lint it - forcing to be thorough.
          - .env
        language: system
        # .env OR .env.foo OR *.env
        # See: https://rubular.com/r/sWEhRn1E2ALnwI
        files: ^(\.env|\.env\.\w+|.+\.env)$
        types:
          - text

      # https://github.com/editorconfig-checker/editorconfig-checker
      - id: editorconfig-checker
        name: "Lint: editorconfig-checker"
        entry: ./bin/run-in-container.sh ec
        language: system
        types:
          - text

      # https://github.com/zricethezav/gitleaks
      - id: gitleaks
        name: "Lint: gitleaks"
        entry: ./bin/run-in-container.sh gitleaks protect
        args:
          - --redact
          - --verbose
        pass_filenames: false
        language: system
        types:
          - text

      # https://github.com/hadolint/hadolint
      - id: hadolint
        name: "Lint: hadolint"
        entry: ./bin/run-in-container.sh hadolint
        language: system
        types:
          - dockerfile

      # https://github.com/prantlf/jsonlint
      - id: jsonlint
        name: "Lint: jsonlint"
        entry: ./bin/run-in-container.sh jsonlint
        args:
          - --config=.jsonlint.yaml
          - --in-place
        language: system
        files: ^(\.ecrc|.+\.github-issues|.+\.json)$ # spell: disable-line

      # https://github.com/igorshubovych/markdownlint-cli
      - id: markdownlint
        name: "Lint: markdownlint"
        entry: ./bin/run-in-container.sh markdownlint
        args:
          - --dot
          - --fix
        language: system
        types:
          - markdown

      # https://github.com/koalaman/shellcheck
      - id: shellcheck
        name: "Lint: shellcheck"
        entry: ./bin/run-in-container.sh shellcheck
        args:
          - --check-sourced
          - --external-sources
          - --source-path=SCRIPTDIR # spell: disable-line
        language: system
        types:
          - shell

      # https://github.com/adrienverge/yamllint
      - id: yamllint
        name: "Lint: yamllint"
        entry: ./bin/run-in-container.sh yamllint
        args:
          - --strict
        language: system
        types:
          - yaml

  - repo: local
    hooks:
      # https://github.com/jorisroovers/gitlint
      - id: gitlint
        name: "Lint: gitlint"
        entry: ./bin/run-in-container.sh gitlint
        args:
          - --staged
          - --msg-filename
        language: system
        stages:
          - commit-msg
